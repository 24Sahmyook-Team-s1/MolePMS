<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Main Page</title>
    <link rel="stylesheet" href="css/MainPage.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css"
    />
    <link rel="stylesheet" href="css/chart.css" />
    <script src="js/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <div class="header">
      <h1>MOLE</h1>
    </div>

    <div class="main-container">
      <div class="ongoing-projects">
        <h2>On Going</h2>
        <div>
          <div class="scroll-container">
            <button class="scroll-btn left">&lt;</button>
            <div class="project-list-wrapper">
              <div class="project-list"></div>
            </div>
            <button class="scroll-btn right">&gt;</button>
          </div>
        </div>
      </div>

      <div>
        <div class="recent-and-gantt">
          <div class="box-col">
            <h2 class="title">Recent Issue</h2>
            <div class="recent-issue-container">
              <div class="recent-issues">
                <div class="issue">Issue: Something on Svelte</div>
                <div class="issue">Issue: Something on Svelte</div>
                <div class="issue">Issue: Something on Svelte</div>
              </div>
            </div>
          </div>

          <div class="box-col">
            <h2 class="title">Gantt Chart</h2>
            <div class="gantt-chart-container">
              <div class="chart-wrapper">
                <ul class="chart-values">
                  <li>Sun</li>
                  <li>Mon</li>
                  <li>Tue</li>
                  <li>Wed</li>
                  <li>Thu</li>
                  <li>Fri</li>
                  <li>Sat</li>
                </ul>
                <ul class="chart-bars">
                  <li data-duration="tue-wed" data-color="#b03532">Task 1</li>
                  <li data-duration="wed-thu" data-color="#33a852">Task 2</li>
                  <li data-duration="thu-fri" data-color="#329ab0">Task 3</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="js/main.js"></script>

    <script>
      $(document).ready(function () {
        loadProjects();

        const projectWrapper = $(".project-list-wrapper");

        setTimeout(() => {
          projectWrapper.scrollLeft(0);
        }, 200);

        let isDown = false;
        let startX;
        let scrollLeft;

        projectWrapper.on("mousedown", function (e) {
          isDown = true;
          projectWrapper.addClass("active");
          startX = e.pageX - projectWrapper.offset().left;
          scrollLeft = projectWrapper.scrollLeft();
        });

        $(document).on("mouseup", function () {
          isDown = false;
          projectWrapper.removeClass("active");
        });

        projectWrapper.on("mousemove", function (e) {
          if (!isDown) return;
          e.preventDefault();
          const x = e.pageX - projectWrapper.offset().left;
          const walk = (x - startX) * 2;
          projectWrapper.scrollLeft(scrollLeft - walk);
        });
      });

      function loadProjects() {
        $.ajax({
          url: "jsp/GetProjectList.jsp",
          type: "GET",
          dataType: "json",
          success: function (projects) {
            showProjects(projects);
          },
          error: function (xhr, status, error) {
            console.error("❌ AJAX 오류 발생:", error);
          },
        });
      }

      function showProjects(projects) {
        var projectContainer = $(".project-list");
        projectContainer.empty();

        if (projects.length > 0) {
          projects.forEach((project) => {
            projectContainer.append(getProjectCode(project));
          });
        } else {
          projectContainer.append("<p>No Ongoing Projects</p>");
        }

        setTimeout(() => {
          $(".project-list-wrapper").scrollLeft(0);
        }, 200);
      }

      function getProjectCode(project) {
        return `
          <div class="project">
              <h3>${project.name}</h3>
              <p>📅 Created At: ${project.created_at}</p>
          </div>
      `;
      }
    </script>
  </body>
</html>
