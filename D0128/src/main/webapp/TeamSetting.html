<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>MOLE - 팀 보드</title>
	<link rel="stylesheet" href="css/TeamBoard.css">
	<script src="js/jquery-3.6.0.min.js"></script>
</head>

<body>
	<!-- 해담바 -->
	<div class="header">
		<h1>MOLE</h1>
	</div>

	<div class="container">
		<!-- 사이드바 -->
		<div class="sidebar">
			<ul>
				<li class="sidebar-link" data-link="MainPage.html">해시보드</li>
				<li class="sidebar-link" data-link="TeamPage.html">팀 페이지</li>
				<li class="sidebar-link" data-link="GanttChart.html">간트 채트</li>
				<li class="sidebar-link" data-link="IssuePage.html">이슈</li>
				<li class="sidebar-link active" data-link="TeamBoard.html">팀 보드</li>
				<li class="sidebar-link active" data-link="TeamSetting.html">팀 세팅</li>
			</ul>
		</div>

		<!-- 메인 컨텐츠 -->
		<div class="contentGrid">
			<div class="card">
				<h2>프로젝트 명: 쌈@빵한 프로젝트 이름</h2>
				<p><strong>책임자:</strong> 책임자이름 (책임자 이메일)</p>
				<p><strong>프로젝트 설명:</strong> 쌈빵한 프로젝트 설명 12356788887654324098490544182358 ^ 235</p>
				<button class="danger-btn">프로젝트 폐기</button>
			</div>
			<div class="card team-container">
				<h3>팀원 관리</h3>
				<button onclick="addTeamMember()">팀원 추가</button>
				<div class="team-list" id="team-list">
					<div class="team-member">
						<span>김재욱 (dummy@molepres.com)</span>
						<button class="remove-btn" onclick="removeMember(this)">제거</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- 프로필 메뉴 -->
	<div class="profile-container">
		<img src="public/logo-transparent.png" alt="MOLE PMS Logo" class="profile-btn" id="profileBtn">
		<div class="profile-menu" id="profileMenu">
			<ul>
				<li data-link="MainPage.html">홈</li>
				<li data-link="TeamPage.html">팀 페이지</li>
				<li data-link="FindTeam.html">팀 찾기</li>
				<li data-link="CreateTeam.html">팀 만들기</li>
				<li data-link="TeamManage.html">팀 관리</li>
				<li data-link="ProfilePage.html">프로필</li>
				<li data-link="SettingsPage.html">설정</li>
			</ul>
		</div>
	</div>
</body>

</html>
<script>
	let userId = null;
	let projectId = null;
	
	// 사이드바 클릭 이벤트
	document.querySelectorAll('.sidebar-link').forEach(link => {
		link.addEventListener('click', function () {
			const targetPage = this.getAttribute('data-link');
			window.location.href = targetPage;
		});
	});

	// 프로필 메뉴 클릭
	const profileBtn = document.getElementById("profileBtn");
	const profileMenu = document.getElementById("profileMenu");

	profileBtn.addEventListener("click", function (event) {
		event.stopPropagation();
		profileMenu.classList.toggle("active");
	});

	document.addEventListener("click", function (event) {
		if (!profileBtn.contains(event.target) && !profileMenu.contains(event.target)) {
			profileMenu.classList.remove("active");
		}
	});

	// 프로필 메뉴 클릭 시 페이지 이동
	document.querySelectorAll('.profile-menu li').forEach(item => {
		item.addEventListener('click', function () {
			const targetPage = this.getAttribute('data-link');
			window.location.href = targetPage;
		});
	});

	$(document).ready(function () {

		$.ajax({
			url: "jsp/session.jsp",
			type: "GET",
			success: function (response) {
				if (response.includes("로그인하지 않았습니다.")) {
					alert("로그인이 필요합니다.");
					window.location.href = "index.html"; // 로그인 페이지로 이동
				}
				else {
					userId = response; // 세션에서 사용자 ID를 가져오는 부분
					console.log("유저 id: " + userId);
					$.ajax({
						url: "jsp/projectsession.jsp",
						type: "GET",
						success: function (response) {
							if (response.includes("error")) {
								alert("프로젝트를 다시골라 주세요.");
								window.location.href = "MainPage.html"; // 메인 페이지로 이동
							}
							else {
								projectId = response; // 세션에서 사용자 ID를 가져오는 부분
								console.log("프로젝트 id: " + projectId);
								console.log("페이지 로드 + 유저 id, 프로젝트 id 완료");
							}
						},
						error: function (xhr, status, error) {
							console.error("세션 확인 중 오류 발생:", error);
						}
					});
					console.log("페이지 로드 + 유저 id, 프로젝트 id 완료");
				}
			},
			error: function (xhr, status, error) {
				console.error("세션 확인 중 오류 발생:", error);
			}
		});
	});
	function addTeamMember() {
		const userID = prompt("초대할 팀원의 이메일을 입력하세요:");
		$.ajax({
			type: "POST",
			url: "jsp/UserInvite.jsp",
			data: {
				userID: userID,
				projectID: projectId
			},
			success: function (response) {
				console.log("UserInvite.jsp 응답:", response);
			},
			error: function (xhr, status, error) {
				console.error("팀원 초대 AJAX 오류:", status, error);
			}
		});
	}

	function removeMember(button) {
		button.parentElement.remove();
	}
</script>