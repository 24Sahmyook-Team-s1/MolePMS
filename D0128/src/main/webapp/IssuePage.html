<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOLE - 이슈 관리</title>
    <link rel="stylesheet" href="css/IssuePage.css">
</head>
<body>

    <!-- 상단바 -->
   <div class="header">
      <h2>MOLE</h2>
    </div>

    <div class="container">
      <!-- 📌 왼쪽 사이드바 -->
        <div class="sidebar">
            <ul>
                <li class="sidebar-link" data-link="MainPage.html">대시보드</li>
                <li class="sidebar-link" data-link="TeamPage.html">팀 페이지</li>
                <li class="sidebar-link" data-link="GanttChart.html">간트 차트</li>
                <li class="sidebar-link" data-link="IssuePage.html">이슈</li>
                <li class="sidebar-link" data-link="TeamBoard.html">팀 보드</li>
            </ul>
        </div>

        <!-- 메인 컨텐츠 -->
        <div class="main-content">
          <h1>
			    <span>위험 관리</span>
			    <div class="issue-buttons">
			        <button class="add-btn">이슈 추가</button>
			        <button class="delete-btn">이슈 삭제</button>
			        <button class="update-btn">이슈 업데이트</button>
			    </div>
			</h1>

            <div class="issue-container">
                <!-- HAZARD -->
                <div class="issue-column hazard">
                    <h2>HAZARD ⚠️</h2>
                    <div class="issue-header">
                        <span>Name</span>
                        <span>Issue Description</span>
                    </div>
                    <div class="issue-list" id="hazardList">
                        <!-- 이슈 항목 추가 영역 -->
                    </div>
                </div>

                <!-- ISSUE -->
                <div class="issue-column issue">
                    <h2>ISSUE ⚠️</h2>
                    <div class="issue-header">
                        <span>Name</span>
                        <span>Issue Description</span>
                    </div>
                    <div class="issue-list" id="issueList">
                        <!-- 이슈 항목 추가 영역 -->
                    </div>
                </div>

                <!-- SOLVED -->
                <div class="issue-column solved">
                    <h2>SOLVED 🟢</h2>
                    <div class="issue-header">
                        <span>Name</span>
                        <span>Issue Description</span>
                    </div>
                    <div class="issue-list" id="solvedList">
                        <!-- 이슈 항목 추가 영역 -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 📌 프로필 메뉴 -->
    <div class="profile-container">
        <img src="public/logo-transparent.png" alt="MOLE PMS Logo" class="profile-btn" id="profileBtn">
        <div class="profile-menu" id="profileMenu">
            <ul>
                <li data-link="MainPage.html">홈</li>
                <li data-link="TeamPage.html">팀 페이지</li>
                <li data-link="FindTeam.html">팀 찾기</li>
                <li data-link="CreateTeam.html">팀 만들기</li>
                <li data-link="TeamManage.html">팀 관리</li>
                <li data-link="ProfilePage.html">프로필</li>
                <li data-link="SettingsPage.html">설정</li>
            </ul>
        </div>
    </div>
    

</body>
</html>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // 사이드바 클릭 시 페이지 이동
    document.querySelectorAll('.sidebar-link').forEach(link => {
        link.addEventListener('click', function () {
            const targetPage = this.getAttribute('data-link');
            window.location.href = targetPage;
        });
    });
});

document.addEventListener("DOMContentLoaded", function () {
    fetchIssues();  // 페이지 로드 시 이슈 목록 불러오기
});

function fetchIssues() {
    fetch('jsp/ProjectissueList.jsp', { method: 'POST' })  // 수정된 경로
        .then(response => response.text())
        .then(data => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(data, 'text/html');
            const issues = doc.querySelectorAll('tbody tr');

            const hazardList = document.getElementById('hazardList');
            const issueList = document.getElementById('issueList');
            const solvedList = document.getElementById('solvedList');

            hazardList.innerHTML = '';
            issueList.innerHTML = '';
            solvedList.innerHTML = '';

            issues.forEach(issue => {
                const title = issue.children[3].innerText;
                const description = issue.children[4].innerText;

                const issueElement = document.createElement('p');
                issueElement.innerHTML = `<span>${title}</span><span>${description}</span>`;

                if (title.includes("HAZARD")) {
                    hazardList.appendChild(issueElement);
                } else if (title.includes("SOLVED")) {
                    solvedList.appendChild(issueElement);
                } else {
                    issueList.appendChild(issueElement);
                }
            });
        })
        .catch(error => {
            console.error('이슈를 불러오는 중 오류 발생:', error);
        });
}



// 📌 프로필 버튼 클릭 시 메뉴 표시
const profileBtn = document.getElementById("profileBtn");
const profileMenu = document.getElementById("profileMenu");

profileBtn.addEventListener("click", function (event) {
    event.stopPropagation();
    profileMenu.classList.toggle("active");
});

document.addEventListener("click", function (event) {
    if (!profileBtn.contains(event.target) && !profileMenu.contains(event.target)) {
        profileMenu.classList.remove("active");
    }
});

// 📌 프로필 메뉴 클릭 시 페이지 이동
document.querySelectorAll('.profile-menu li').forEach(item => {
    item.addEventListener('click', function () {
        const targetPage = this.getAttribute('data-link');
        window.location.href = targetPage;
    });
});
//이슈 추가 버튼 클릭 시
document.querySelector('.add-btn').addEventListener('click', function() {
    window.location.href = 'jsp/projectIssueAdd.jsp';  // 수정된 경로
});

// 이슈 삭제 버튼 클릭 시
document.querySelector('.delete-btn').addEventListener('click', function() {
    window.location.href = 'jsp/projectIssueDelete.jsp';  // 수정된 경로
});

// 이슈 업데이트 버튼 클릭 시
document.querySelector('.update-btn').addEventListener('click', function() {
    window.location.href = 'jsp/projectIssueUpdate.jsp';  // 수정된 경로
});

</script>
